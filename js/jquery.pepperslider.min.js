/*
 * Copyright 2012 Damien SEGUIN
 * http://damienseguin.me/
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CON* NECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

(function(a,b,c){var d="pepperSlider",e=b.document,f={activeClass:"pepperSliderActiveClass",animation:"fade",continuous:!0,keyboardNav:!0,timer:3e3,speed:1e3,parallax:"",overStop:!1,startAt:1,pagination:{id:"pagination",type:"number"}},g=function(b,c){this.$element=a(b),this.$elementList=a(b).find("> ul"),this.$elementListAndPagination=a(b).find("> ul, > ol"),this.options=a.extend({},f,c),this._defaults=f,this._name=d,this._init()};g.prototype={_init:function(){var b;this.length=this.$elementList.find("> li").length,this._animate(this.options.startAt),this.options.continuous&&(this.isRunning=!0,this.interval=setInterval(a.proxy(this._switchActive,this),this.options.timer)),this.options.animation=="cycle"&&this.$elementList.css("width",this.length*this.$element.width());if(this.options.pagination.id){b=1;if(Object.prototype.toString.call(this.options.pagination.type)==="[object Array]")while(b<this.options.pagination.type.length+1)b==this.options.startAt?a(e.createElement("li")).addClass(this.options.activeClass).html("<a data-controls="+b+" href='#'>"+this.options.pagination.type[b-1]+"</a>").appendTo("#"+this.options.pagination.id):a(e.createElement("li")).html("<a data-controls="+b+" href='#'>"+this.options.pagination.type[b-1]+"</a>").appendTo("#"+this.options.pagination.id),++b;else if(this.options.pagination.type=="number")while(b<this.length+1)b==this.options.startAt?a(e.createElement("li")).addClass(this.options.activeClass).html("<a data-controls="+b+" href='#'>"+b+"</a>").appendTo("#"+this.options.pagination.id):a(e.createElement("li")).html("<a data-controls="+b+" href='#'>"+b+"</a>").appendTo("#"+this.options.pagination.id),++b}this.$element.on("click","a",a.proxy(this._on,this)),this.options.keyboardNav&&(that=this,a(e).keydown(function(a){switch(a.keyCode){case 37:that._switchActive("prev");break;case 39:that._switchActive("next")}})),this.options.overStop&&this.$element.on("mouseenter mouseleave",a.proxy(this._on,this))},_on:function(b){b.type=="mouseenter"&&this.interval?(this.isRunning=!1,clearInterval(this.interval)):b.type=="mouseleave"?(this.isRunning=!0,clearInterval(this.interval),this.interval=setInterval(a.proxy(this._switchActive,this),this.options.timer)):b.type=="click"&&(b.preventDefault(),b.stopImmediatePropagation(),control=a(b.currentTarget).data("controls"),this._switchActive(control))},_animate:function(b){var f,d=this.$elementListAndPagination.find("."+this.options.activeClass),e=this.$elementListAndPagination.find("> li:nth-child("+b+")");oldActive=this.$elementList.find("."+this.options.activeClass),newActive=this.$elementList.find("> li:nth-child("+b+")"),d.removeClass(this.options.activeClass),e.addClass(this.options.activeClass),a("html").hasClass("no-csstransitions")&&this.options.animation=="fade"&&(oldActive.fadeOut(),newActive.fadeIn()),this.options.animation=="cycle"&&this.$elementList.stop(!0).animate({left:-e.position().left},this.options.speed);if(this.options.parallax){f=this;this.$elementList.children(":lt("+(b-1)+")").removeClass("after").addClass("before"),this.$elementList.children(":gt("+(b-1)+")").removeClass("before").addClass("after"),this.$elementList.find("."+f.options.parallax+" *").each(function(){offset=a(this).data("offset"),offset===c&&(offset=f.options.speed/2),a(this).parent().parent().hasClass(f.options.activeClass)?a(this).stop(!0).animate({"margin-left":0},500):a(this).parent().parent().hasClass("before")?a(this).stop(!0).animate({"margin-left":-offset},500):a(this).parent().parent().hasClass("after")&&a(this).stop(!0).animate({"margin-left":offset},500)})}},_switchActive:function(b){var c=this.$elementList.find("."+this.options.activeClass),d=this.$elementList.find("> li").index(c);typeof b=="string"||typeof b=="undefined"?(b=="onoff"&&($targetIndex=d,this.isRunning=!this.isRunning),b=="next"||typeof b=="undefined"?$targetIndex=d+1:b=="prev"&&($targetIndex=d-1),$targetIndex>this.length-1?$targetIndex=0:$targetIndex<0&&($targetIndex=this.length-1),$targetIndex+=1):typeof b=="number"&&($targetIndex=b);if(this.interval&&typeof b!="undefined"||b=="onoff")clearInterval(this.interval),this.isRunning&&(this.interval=setInterval(a.proxy(this._switchActive,this),this.options.timer));this._animate($targetIndex)}},a.fn[d]=function(b){return this.each(function(){a.data(this,"plugin_"+d)||a.data(this,"plugin_"+d,new g(this,b))})}})(jQuery,window)