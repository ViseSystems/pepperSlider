/*
 * Copyright 2012 Damien SEGUIN
 * http://damienseguin.me/
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CON* NECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

(function(e,t,n){var r="pepperSlider",i=t.document,s={activeClass:"pepperSliderActiveClass",animation:"fade",continuous:true,keyboardNav:true,timer:3e3,speed:1e3,parallax:"",easing:"linear",overStop:false,startAt:1,pagination:{id:"pagination",type:"number"}};var o=function(t,n){this.$element=e(t);this.$elementList=e(t).find("> ul");this.$elementListAndPagination=e(t).find("> ul, > ol");this.options=e.extend({},s,n);this._defaults=s;this._name=r;this._init()};o.prototype={_init:function(){this.length=this.$elementList.find("> li").length;this._animate(this.options.startAt);if(this.options.continuous){this.isRunning=true;this.interval=setInterval(e.proxy(this._switchActive,this),this.options.timer)}if(this.options.animation=="cycle"){this.$elementList.css("width",this.length*this.$element.width())}if(this.options.pagination.id){var t=1;if(Object.prototype.toString.call(this.options.pagination.type)==="[object Array]"){while(t<this.options.pagination.type.length+1){if(t==this.options.startAt){e(i.createElement("li")).addClass(this.options.activeClass).html("<a data-controls="+t+" href='#'>"+this.options.pagination.type[t-1]+"</a>").appendTo("#"+this.options.pagination.id)}else{e(i.createElement("li")).html("<a data-controls="+t+" href='#'>"+this.options.pagination.type[t-1]+"</a>").appendTo("#"+this.options.pagination.id)}++t}}else if(this.options.pagination.type=="number"){while(t<this.length+1){if(t==this.options.startAt){e(i.createElement("li")).addClass(this.options.activeClass).html("<a data-controls="+t+" href='#'>"+t+"</a>").appendTo("#"+this.options.pagination.id)}else{e(i.createElement("li")).html("<a data-controls="+t+" href='#'>"+t+"</a>").appendTo("#"+this.options.pagination.id)}++t}}}this.$element.on("click","a",e.proxy(this._on,this));if(this.options.keyboardNav){that=this;e(i).keydown(function(e){switch(e.keyCode){case 37:that._switchActive("prev");break;case 39:that._switchActive("next");break}})}if(this.options.overStop)this.$element.on("mouseenter mouseleave",e.proxy(this._on,this))},_on:function(t){if(t.type=="mouseenter"&&this.interval){this.isRunning=false;clearInterval(this.interval)}else if(t.type=="mouseleave"){this.isRunning=true;clearInterval(this.interval);this.interval=setInterval(e.proxy(this._switchActive,this),this.options.timer)}else if(t.type=="click"){t.preventDefault();t.stopImmediatePropagation();control=e(t.currentTarget).data("controls");this._switchActive(control)}},_animate:function(t){var r=this.$elementListAndPagination.find("."+this.options.activeClass),i=this.$elementListAndPagination.find("> li:nth-child("+t+")");oldActive=this.$elementList.find("."+this.options.activeClass),newActive=this.$elementList.find("> li:nth-child("+t+")");r.removeClass(this.options.activeClass);i.addClass(this.options.activeClass);if(e("html").hasClass("no-csstransitions")&&this.options.animation=="fade"){oldActive.fadeOut();newActive.fadeIn()}if(this.options.animation=="cycle"){this.$elementList.stop(true).animate({left:-i.position().left},this.options.speed)}if(this.options.parallax){var s=this;this.$elementList.children(":lt("+(t-1)+")").removeClass("after").addClass("before");this.$elementList.children(":gt("+(t-1)+")").removeClass("before").addClass("after");this.$elementList.find("."+s.options.parallax+" *").each(function(){offset=e(this).data("offset");if(offset===n){offset=s.options.speed/2}if(e(this).parent().parent().hasClass(s.options.activeClass)){e(this).stop(true).animate({"margin-left":0},500,this.options.easing)}else{if(e(this).parent().parent().hasClass("before")){e(this).stop(true).animate({"margin-left":-offset},500,this.options.easing)}else if(e(this).parent().parent().hasClass("after")){e(this).stop(true).animate({"margin-left":offset},500,this.options.easing)}}})}},_switchActive:function(t){var n=this.$elementList.find("."+this.options.activeClass),r=this.$elementList.find("> li").index(n);if(typeof t=="string"||typeof t=="undefined"){if(t=="onoff"){$targetIndex=r;this.isRunning=!this.isRunning}if(t=="next"||typeof t=="undefined"){$targetIndex=r+1}else if(t=="prev"){$targetIndex=r-1}if($targetIndex>this.length-1){$targetIndex=0}else if($targetIndex<0){$targetIndex=this.length-1}$targetIndex+=1}else if(typeof t=="number"){$targetIndex=t}if(this.interval&&typeof t!=="undefined"||t=="onoff"){clearInterval(this.interval);if(this.isRunning){this.interval=setInterval(e.proxy(this._switchActive,this),this.options.timer)}}this._animate($targetIndex)}};e.fn[r]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+r)){e.data(this,"plugin_"+r,new o(this,t))}})}})(jQuery,window)